function enableHighDPICanvas(e){"string"==typeof e&&(e=document.getElementById(e));var t=window.devicePixelRatio||1;if(1!==t){var n=e.width,l=e.height;e.width=n*t,e.height=l*t,e.style.width=n+"px",e.style.height=l+"px",e.getContext("2d").scale(t,t)}}function showErrorMessage(e){var t=document.getElementById("message");e&&0!==e.trim().length?t.style.display="block":t.style.display="none",t.innerHTML=e}function pathCommandToString(e){var t;return"<strong>"+e.type+"</strong> "+(void 0!==e.x?"x="+e.x+" y="+e.y+" ":"")+(void 0!==e.x1?"x1="+e.x1+" y1="+e.y1+" ":"")+(void 0!==e.x2?"x2="+e.x2+" y2="+e.y2:"")}function contourToString(e){return'<pre class="contour">'+e.map((function(e){return'<span class="'+(e.onCurve?"on":"off")+'curve">x='+e.x+" y="+e.y+"</span>"})).join("\n")+"</pre>"}function formatUnicode(e){return(e=e.toString(16)).length>4?("000000"+e.toUpperCase()).substr(-6):("0000"+e.toUpperCase()).substr(-4)}function displayGlyphData(e){var t=document.getElementById("glyph-data");if(e<0)t.innerHTML="";else{var n=font.glyphs.get(e),l="<dl>",i;if(l+="<dt>name</dt><dd>"+n.name+"</dd>",n.unicodes.length>0&&(l+="<dt>unicode</dt><dd>"+n.unicodes.map(formatUnicode).join(", ")+"</dd>"),l+="<dt>index</dt><dd>"+n.index+"</dd>",0===n.xMin&&0===n.xMax&&0===n.yMin&&0===n.yMax||(l+="<dt>xMin</dt><dd>"+n.xMin+"</dd><dt>xMax</dt><dd>"+n.xMax+"</dd><dt>yMin</dt><dd>"+n.yMin+"</dd><dt>yMax</dt><dd>"+n.yMax+"</dd>"),l+="<dt>advanceWidth</dt><dd>"+n.advanceWidth+"</dd>",void 0!==n.leftSideBearing&&(l+="<dt>leftSideBearing</dt><dd>"+n.leftSideBearing+"</dd>"),l+="</dl>",n.numberOfContours>0)l+='contours:<div id="glyph-contours">'+n.getContours().map(contourToString).join("\n")+"</div>";else n.isComposite?l+="<br>This composite glyph is a combination of :<ul><li>"+n.components.map((function(e){return void 0===e.matchedPoints?"glyph "+e.glyphIndex+" at dx="+e.dx+", dy="+e.dy:"glyph "+e.glyphIndex+" at matchedPoints=["+e.matchedPoints+"]"})).join("</li><li>")+"</li></ul>":n.path&&(l+="path:<br><pre>  "+n.path.commands.map(pathCommandToString).join("\n  ")+"\n</pre>");t.innerHTML=l}}function drawArrow(e,t,n,l,i){var a=l-t,o=i-n,d=Math.sqrt(a*a+o*o),r=a/d,s=o/d,c=l-arrowLength*r,y=i-arrowLength*s,h=arrowAperture*s,p=-arrowAperture*r;e.beginPath(),e.moveTo(l,i),e.lineTo(c+h,y+p),e.lineTo(c-h,y-p),e.lineTo(l,i),e.closePath(),e.fill()}function drawPathWithArrows(e,t){var n,l,i,a,o,d,r=[];for(e.beginPath(),n=0;n<t.commands.length;n+=1)"M"===(l=t.commands[n]).type?(void 0!==i&&r.push([e,i,a,o,d]),e.moveTo(l.x,l.y)):"L"===l.type?(e.lineTo(l.x,l.y),i=o,a=d):"C"===l.type?(e.bezierCurveTo(l.x1,l.y1,l.x2,l.y2,l.x,l.y),i=l.x2,a=l.y2):"Q"===l.type?(e.quadraticCurveTo(l.x1,l.y1,l.x,l.y),i=l.x1,a=l.y1):"Z"===l.type&&(r.push([e,i,a,o,d]),e.closePath()),o=l.x,d=l.y;t.fill&&(e.fillStyle=t.fill,e.fill()),t.stroke&&(e.strokeStyle=t.stroke,e.lineWidth=t.strokeWidth,e.stroke()),e.fillStyle="#000000",r.forEach((function(e){drawArrow.apply(null,e)}))}function displayGlyph(e){var t=document.getElementById("glyph"),n=t.getContext("2d"),l=t.width/pixelRatio,i=t.height/pixelRatio;if(n.clearRect(0,0,l,i),!(e<0)){var a=font.glyphs.get(e),o=a.advanceWidth*glyphScale,d=(l-o)/2,r=(l+o)/2,s=d,c=10;n.fillStyle="#606060",n.fillRect(d-c+1,glyphBaseline,c,1),n.fillRect(d,glyphBaseline,1,c),n.fillRect(r,glyphBaseline,c,1),n.fillRect(r,glyphBaseline,1,c),n.textAlign="center",n.fillText("0",d,glyphBaseline+c+10),n.fillText(a.advanceWidth,r,glyphBaseline+c+10),n.fillStyle="#000000";var y=a.getPath(s,glyphBaseline,glyphSize);y.fill="#808080",y.stroke="#000000",y.strokeWidth=1.5,drawPathWithArrows(n,y),a.drawPoints(n,s,glyphBaseline,glyphSize)}}function renderGlyphItem(e,t){var n=4,l=e.getContext("2d");if(l.clearRect(0,0,cellWidth,cellHeight),!(t>=font.numGlyphs)){l.fillStyle="#606060",l.font="9px sans-serif",l.fillText(t,1,cellHeight-1);var i=font.glyphs.get(t),a=i.advanceWidth*fontScale,o=(cellWidth-a)/2,d=(cellWidth+a)/2,r=o;l.fillStyle="#a0a0a0",l.fillRect(o-4+1,fontBaseline,4,1),l.fillRect(o,fontBaseline,1,4),l.fillRect(d,fontBaseline,4,1),l.fillRect(d,fontBaseline,1,4),l.fillStyle="#000000",i.draw(l,r,fontBaseline,fontSize)}}function displayGlyphPage(e){pageSelected=e,document.getElementById("p"+e).className="page-selected";for(var t=e*cellCount,n=0;n<cellCount;n++)renderGlyphItem(document.getElementById("g"+n),t+n)}function pageSelect(e){document.getElementsByClassName("page-selected")[0].className="",displayGlyphPage(+e.target.id.substr(1))}function initGlyphDisplay(){function e(e,t){ypx=glyphBaseline-t*glyphScale,r.fillText(e,2,ypx+3),r.fillRect(80,ypx,n,1)}var t=document.getElementById("glyph-bg"),n=t.width/pixelRatio,l=t.height/pixelRatio,i=n-2*glyphMargin,a=l-2*glyphMargin,o=font.tables.head,d=o.yMax-o.yMin,r=t.getContext("2d");glyphScale=Math.min(i/(o.xMax-o.xMin),a/d),glyphSize=glyphScale*font.unitsPerEm,glyphBaseline=glyphMargin+a*o.yMax/d,r.clearRect(0,0,n,l),r.fillStyle="#a0a0a0",e("Baseline",0),e("yMax",font.tables.head.yMax),e("yMin",font.tables.head.yMin),e("Ascender",font.tables.hhea.ascender),e("Descender",font.tables.hhea.descender),e("Typo Ascender",font.tables.os2.sTypoAscender),e("Typo Descender",font.tables.os2.sTypoDescender)}function onFontLoaded(e){window.font=e;var t=cellWidth-2*cellMarginLeftRight,n=cellHeight-cellMarginTop-cellMarginBottom,l=e.tables.head,i=l.yMax-l.yMin;fontScale=Math.min(t/(l.xMax-l.xMin),n/i),fontSize=fontScale*e.unitsPerEm,fontBaseline=cellMarginTop+n*l.yMax/i;var a=document.getElementById("pagination");a.innerHTML="";for(var o=document.createDocumentFragment(),d=Math.ceil(e.numGlyphs/cellCount),r=0;r<d;r++){var s=document.createElement("span"),c=Math.min(e.numGlyphs-1,(r+1)*cellCount-1);s.textContent=r*cellCount+"-"+c,s.id="p"+r,s.addEventListener("click",pageSelect,!1),o.appendChild(s),o.appendChild(document.createTextNode(" "))}a.appendChild(o),initGlyphDisplay(),displayGlyphPage(0),displayGlyph(-1),displayGlyphData(-1)}function onReadFile(e){document.getElementById("font-name").innerHTML="";var t=e.target.files[0],n=new FileReader;n.onload=function(e){try{font=opentype.parse(e.target.result,{lowMemory:!0}),showErrorMessage(""),onFontLoaded(font)}catch(e){throw showErrorMessage(e.toString()),e.stack&&console.log(e.stack),e}},n.onerror=function(e){showErrorMessage(e.toString())},n.readAsArrayBuffer(t)}function cellSelect(e){if(font){var t,n,l=pageSelected*cellCount+ +e.target.id.substr(1);l<font.numGlyphs&&(displayGlyph(l),displayGlyphData(l))}}function prepareGlyphList(){for(var e=document.getElementById("glyph-list-end"),t=e.parentElement,n=0;n<cellCount;n++){var l=document.createElement("canvas");l.width=cellWidth,l.height=cellHeight,l.className="item",l.id="g"+n,l.addEventListener("click",cellSelect,!1),enableHighDPICanvas(l),t.insertBefore(l,e)}}var cellCount=100,cellWidth=44,cellHeight=40,cellMarginTop=1,cellMarginBottom=8,cellMarginLeftRight=1,glyphMargin=5,pixelRatio=window.devicePixelRatio||1,pageSelected,font,fontScale,fontSize,fontBaseline,glyphScale,glyphSize,glyphBaseline,arrowLength=10,arrowAperture=4;