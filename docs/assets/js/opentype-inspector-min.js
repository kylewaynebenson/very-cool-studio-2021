var pageSelected,font,fontScale,fontSize,fontBaseline,glyphScale,glyphSize,glyphBaseline,cellCount=100,cellWidth=44,cellHeight=40,cellMarginTop=1,cellMarginBottom=8,cellMarginLeftRight=1,glyphMargin=5,pixelRatio=window.devicePixelRatio||1;function enableHighDPICanvas(e){"string"==typeof e&&(e=document.getElementById(e));var t,n,l=window.devicePixelRatio||1;1!==l&&(t=e.width,n=e.height,e.width=t*l,e.height=n*l,e.style.width=t+"px",e.style.height=n+"px",e.getContext("2d").scale(l,l))}function showErrorMessage(e){var t=document.getElementById("message");e&&0!==e.trim().length?t.style.display="block":t.style.display="none",t.innerHTML=e}function pathCommandToString(e){return"<strong>"+e.type+"</strong> "+(void 0!==e.x?"x="+e.x+" y="+e.y+" ":"")+(void 0!==e.x1?"x1="+e.x1+" y1="+e.y1+" ":"")+(void 0!==e.x2?"x2="+e.x2+" y2="+e.y2:"")}function contourToString(e){return'<pre class="contour">'+e.map(function(e){return'<span class="'+(e.onCurve?"on":"off")+'curve">x='+e.x+" y="+e.y+"</span>"}).join("\n")+"</pre>"}function formatUnicode(e){return 4<(e=e.toString(16)).length?("000000"+e.toUpperCase()).substr(-6):("0000"+e.toUpperCase()).substr(-4)}function displayGlyphData(e){var t,n=document.getElementById("glyph-data");e<0?n.innerHTML="":(t="<dl>",t+="<dt>name</dt><dd>"+(e=font.glyphs.get(e)).name+"</dd>",0<e.unicodes.length&&(t+="<dt>unicode</dt><dd>"+e.unicodes.map(formatUnicode).join(", ")+"</dd>"),t+="<dt>index</dt><dd>"+e.index+"</dd>",0===e.xMin&&0===e.xMax&&0===e.yMin&&0===e.yMax||(t+="<dt>xMin</dt><dd>"+e.xMin+"</dd><dt>xMax</dt><dd>"+e.xMax+"</dd><dt>yMin</dt><dd>"+e.yMin+"</dd><dt>yMax</dt><dd>"+e.yMax+"</dd>"),t+="<dt>advanceWidth</dt><dd>"+e.advanceWidth+"</dd>",void 0!==e.leftSideBearing&&(t+="<dt>leftSideBearing</dt><dd>"+e.leftSideBearing+"</dd>"),t+="</dl>",0<e.numberOfContours?t+='contours:<div id="glyph-contours">'+e.getContours().map(contourToString).join("\n")+"</div>":e.isComposite?t+="<br>This composite glyph is a combination of :<ul><li>"+e.components.map(function(e){return void 0===e.matchedPoints?"glyph "+e.glyphIndex+" at dx="+e.dx+", dy="+e.dy:"glyph "+e.glyphIndex+" at matchedPoints=["+e.matchedPoints+"]"}).join("</li><li>")+"</li></ul>":e.path&&(t+="path:<br><pre>  "+e.path.commands.map(pathCommandToString).join("\n  ")+"\n</pre>"),n.innerHTML=t)}var arrowLength=10,arrowAperture=4;function drawArrow(e,t,n,l,i){var t=l-t,n=i-n,a=Math.sqrt(t*t+n*n),t=t/a,n=n/a,a=l-arrowLength*t,o=i-arrowLength*n,n=arrowAperture*n,t=-arrowAperture*t;e.beginPath(),e.moveTo(l,i),e.lineTo(a+n,o+t),e.lineTo(a-n,o-t),e.lineTo(l,i),e.closePath(),e.fill()}function drawPathWithArrows(e,t){var n,l,i,a,o,d,r=[];for(e.beginPath(),n=0;n<t.commands.length;n+=1)"M"===(l=t.commands[n]).type?(void 0!==i&&r.push([e,i,a,o,d]),e.moveTo(l.x,l.y)):"L"===l.type?(e.lineTo(l.x,l.y),i=o,a=d):"C"===l.type?(e.bezierCurveTo(l.x1,l.y1,l.x2,l.y2,l.x,l.y),i=l.x2,a=l.y2):"Q"===l.type?(e.quadraticCurveTo(l.x1,l.y1,l.x,l.y),i=l.x1,a=l.y1):"Z"===l.type&&(r.push([e,i,a,o,d]),e.closePath()),o=l.x,d=l.y;t.fill&&(e.fillStyle=t.fill,e.fill()),t.stroke&&(e.strokeStyle=t.stroke,e.lineWidth=t.strokeWidth,e.stroke()),e.fillStyle="#000000",r.forEach(function(e){drawArrow.apply(null,e)})}function displayGlyph(e){var t,n,l=document.getElementById("glyph"),i=l.getContext("2d"),a=l.width/pixelRatio,l=l.height/pixelRatio;i.clearRect(0,0,a,l),e<0||(t=(a+(e=(l=font.glyphs.get(e)).advanceWidth*glyphScale))/2,e=a=(a-e)/2,n=10,i.fillStyle="#606060",i.fillRect(a-n+1,glyphBaseline,n,1),i.fillRect(a,glyphBaseline,1,n),i.fillRect(t,glyphBaseline,n,1),i.fillRect(t,glyphBaseline,1,n),i.textAlign="center",i.fillText("0",a,glyphBaseline+n+10),i.fillText(l.advanceWidth,t,glyphBaseline+n+10),i.fillStyle="#000000",(a=l.getPath(e,glyphBaseline,glyphSize)).fill="#808080",a.stroke="#000000",a.strokeWidth=1.5,drawPathWithArrows(i,a),l.drawPoints(i,e,glyphBaseline,glyphSize))}function renderGlyphItem(e,t){var n,l,i,e=e.getContext("2d");e.clearRect(0,0,cellWidth,cellHeight),t>=font.numGlyphs||(e.fillStyle="#606060",e.font="9px sans-serif",e.fillText(t,1,cellHeight-1),n=(t=font.glyphs.get(t)).advanceWidth*fontScale,l=(cellWidth+n)/2,i=n=(cellWidth-n)/2,e.fillStyle="#a0a0a0",e.fillRect(n-4+1,fontBaseline,4,1),e.fillRect(n,fontBaseline,1,4),e.fillRect(l,fontBaseline,4,1),e.fillRect(l,fontBaseline,1,4),e.fillStyle="#000000",t.draw(e,i,fontBaseline,fontSize))}function displayGlyphPage(e){pageSelected=e,document.getElementById("p"+e).className="page-selected";for(var t=e*cellCount,n=0;n<cellCount;n++)renderGlyphItem(document.getElementById("g"+n),t+n)}function pageSelect(e){document.getElementsByClassName("page-selected")[0].className="",displayGlyphPage(+e.target.id.substr(1))}function initGlyphDisplay(){var e=document.getElementById("glyph-bg"),n=e.width/pixelRatio,t=e.height/pixelRatio,l=n-2*glyphMargin,i=t-2*glyphMargin,a=font.tables.head,o=a.yMax-a.yMin,d=e.getContext("2d");function r(e,t){ypx=glyphBaseline-t*glyphScale,d.fillText(e,2,ypx+3),d.fillRect(80,ypx,n,1)}glyphScale=Math.min(l/(a.xMax-a.xMin),i/o),glyphSize=glyphScale*font.unitsPerEm,glyphBaseline=glyphMargin+i*a.yMax/o,d.clearRect(0,0,n,t),d.fillStyle="#a0a0a0",r("Baseline",0),r("yMax",font.tables.head.yMax),r("yMin",font.tables.head.yMin),r("Ascender",font.tables.hhea.ascender),r("Descender",font.tables.hhea.descender),r("Typo Ascender",font.tables.os2.sTypoAscender),r("Typo Descender",font.tables.os2.sTypoDescender)}function onFontLoaded(e){window.font=e;for(var t=cellHeight-cellMarginTop-cellMarginBottom,n=e.tables.head,l=n.yMax-n.yMin,t=(fontScale=Math.min((cellWidth-2*cellMarginLeftRight)/(n.xMax-n.xMin),t/l),fontSize=fontScale*e.unitsPerEm,fontBaseline=cellMarginTop+t*n.yMax/l,document.getElementById("pagination")),i=(t.innerHTML="",document.createDocumentFragment()),a=Math.ceil(e.numGlyphs/cellCount),o=0;o<a;o++){var d=document.createElement("span"),r=Math.min(e.numGlyphs-1,(o+1)*cellCount-1);d.textContent=o*cellCount+"-"+r,d.id="p"+o,d.addEventListener("click",pageSelect,!1),i.appendChild(d),i.appendChild(document.createTextNode(" "))}t.appendChild(i),initGlyphDisplay(),displayGlyphPage(0),displayGlyph(-1),displayGlyphData(-1)}function onReadFile(e){document.getElementById("font-name").innerHTML="";var e=e.target.files[0],t=new FileReader;t.onload=function(e){try{font=opentype.parse(e.target.result,{lowMemory:!0}),showErrorMessage(""),onFontLoaded(font)}catch(e){throw showErrorMessage(e.toString()),e.stack&&console.log(e.stack),e}},t.onerror=function(e){showErrorMessage(e.toString())},t.readAsArrayBuffer(e)}function cellSelect(e){font&&(e=pageSelected*cellCount+ +e.target.id.substr(1))<font.numGlyphs&&(displayGlyph(e),displayGlyphData(e))}function prepareGlyphList(){for(var e=document.getElementById("glyph-list-end"),t=e.parentElement,n=0;n<cellCount;n++){var l=document.createElement("canvas");l.width=cellWidth,l.height=cellHeight,l.className="item",l.id="g"+n,l.addEventListener("click",cellSelect,!1),enableHighDPICanvas(l),t.insertBefore(l,e)}}